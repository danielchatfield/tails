#!/bin/sh

for dir in chroot/{dev/pts,proc,sys,var/lib/dpkg} ; do
   if mountpoint -q "$dir" ; then
      umount "$dir"
   fi
done

lb clean noauto ${@}

# rm -f build-*.log

# Remove generated files
rm -f config/binary config/bootstrap config/chroot config/common config/source

# Remove empty directories in config tree
if ls config/*/ > /dev/null 2>&1 ; then
	rmdir --ignore-fail-on-non-empty config/*/
fi

# files copied or created in the config stage
rm -f config/includes.chroot/etc/amnesia/environment
rm -f config/includes.chroot/etc/amnesia/version
rm -f config/includes.chroot/usr/share/doc/amnesia/Changelog
for list in config/package-lists/*.list.chroot ; do
   if [ "$list" != 'config/package-lists/tails.list.chroot' ]; then
      rm -f "$list"
   fi
done

# files copied or created in the build stage
rm -f \
   config/environment.binary \
   config/environment.chroot \
   config/tails/variables

# static wiki
rm -rf config/includes.chroot/usr/share/doc/tails/website wiki/src/.ikiwiki
find wiki/src -name *.pot -exec rm {} \;
