[[!toc levels=2]]

# Roadmap

We have to adapt our codebase to Torbutton 1.5.1 or later,
if possible early in the 0.18 dev cycle.

Tails roughly adapted with Torbutton 1.5.1 (`feature/torbutton-1.5.x`)
seems to mostly work, but:

* Have our branding extension enabled by default again,
  so that the right homepage is shown etc.
* Make sure that the Browser-based update notification
  ([[!tor_bug 7495]] and [[!tor_bug 6156]]) is disabled.
* Verify that our custom prefs are set
* Verify that cookies are cleared on exit/start even without
  `extensions.torbutton.clear_cookies`.

# Problem description

Tails 0.17.x ship a month old snapshot of Torbutton
(1.5.0~pre-alpha-1).

Between 1.5.0~pre and 1.5.x final, Torbutton and TBB have changed
quite a lot the way they handle Firefox preferences. We have to
update quite a lot of how we configure Iceweasel in Tails.

* We have to migrate to the new Torbutton simplified prefs
  ([[!tor_bug 3100]])
* We perhaps have to migrate the way we configure Iceweasel to
  TBB's new shiny way (`#tor.js` and `extension-overrides.js`).

Freely quoting Mike Perry:

* [about our branding extension] so I am not sure how you want to
  handle updating the default browser prefs. we also went with an ugly
  hack there of shoving a #tor.js pref file next to firefox.js
* I wonder if that same thing can be done from your branding
  extension.. I'm sort of surprised you're able to overwrite browser
  default prefs from there. I didn't think that was normally possible
  from extensions
  - here's our pref file for Tor Browser:
    `build-scripts/config/pound_tor.js`
  - and here's our new extensions-overrides file:
    `build-scripts/config/extension-overrides.js`
  - here's the makefile hacks to shove the browser prefs and the
    extension overrides into place:
    `build-scripts/linux.mk`
  - those two changes make it so our default pref values are now
    actually defaults in about:config
* I also cleaned up and reduced number of prefs we set
* oh, we also moved away from auto socksport.. we chose 9150 for
  socks, and 9151 for control port.. you may need to tweak that.
* and you want to build FF with --disable-webrtc
  > Apparently this is to disable WebRTC's potential UDP proxy bypass
  > ([[!tor_bug 8178]]). This probably can't happen in Tails, so
  > probably we don't care. This has to be verified, though.
