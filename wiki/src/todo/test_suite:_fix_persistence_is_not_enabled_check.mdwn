[[!tag todo/code]]

This check is incorrect:

    data_part_dev = boot_device + "2"
    assert(!@vm.execute("grep -q '^#{data_part_dev} ' /proc/mounts").success?,
           "Partition '#{data_part_dev}' from the boot device is mounted")

I believe it will success even if persistence is enabled.
